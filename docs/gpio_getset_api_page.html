<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libbgpiod: Mixing Input and Output Operations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libbgpiod
   &#160;<span id="projectnumber">0.3.0</span>
   </div>
   <div id="projectbrief">basic/bloodnok gpio library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('gpio_getset_api_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Mixing Input and Output Operations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To mix input and output operations you will simply interleave the calls to <code><a class="el" href="bgpiod_8c.html#a22eabec5d3b9ed223f79624b134fa100">bgpio_fetch()</a></code> and <code><a class="el" href="bgpiod_8c.html#a0715d8885733ba28d045d0063c9d5daf">bgpio_set()</a></code>, while manipulating the bitmask in your <code><a class="el" href="structbgpio__request.html">bgpio_request</a>-&gt;line_values</code> struct.</p>
<p>An example can be found in <code>get_and_set.c</code> in the examples directory.</p>
<p>From the <code>main</code> function in that file:</p>
<p> <div class="fragment"></div><!-- fragment --><p>After opening the device, we add our gpio lines to the request. Here we start with an input line: </p><div class="fragment"><div class="line">    line0_name = <a class="code" href="bgpiod_8c.html#ab845cc372ba3506973ba09cb1d4bbfd7">bgpio_configure_line</a>(request, line0,</div>
<div class="line">                      GPIO_V2_LINE_FLAG_INPUT);</div>
<div class="line">    <span class="keywordflow">if</span> (!line0_name) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Invalid line (%d) for chip.\n&quot;</span>, line0);</div>
<div class="line">        exit(EINVAL);</div>
<div class="line">    }</div>
<div class="ttc" id="abgpiod_8c_html_ab845cc372ba3506973ba09cb1d4bbfd7"><div class="ttname"><a href="bgpiod_8c.html#ab845cc372ba3506973ba09cb1d4bbfd7">bgpio_configure_line</a></div><div class="ttdeci">char * bgpio_configure_line(bgpio_request_t *req, int line, uint64_t flags,...)</div><div class="ttdef"><b>Definition:</b> <a href="bgpiod_8c_source.html#l00260">bgpiod.c:260</a></div></div>
</div><!-- fragment --><p>And then an output line, with initial output of 0: </p><div class="fragment"><div class="line"> </div>
<div class="line">    line1_name = <a class="code" href="bgpiod_8c.html#ab845cc372ba3506973ba09cb1d4bbfd7">bgpio_configure_line</a>(request, line1,</div>
<div class="line">                      GPIO_V2_LINE_FLAG_OUTPUT, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (!line1_name) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Invalid line (%d) for chip.\n&quot;</span>, line1);</div>
<div class="line">        exit(EINVAL);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>We complete the request, just as in <code>get.c</code> and <code>set.c</code>: </p><div class="fragment"><div class="line"> </div>
<div class="line">    err = <a class="code" href="bgpiod_8c.html#ad9194ca37b57a3386cd88c60a7120833">bgpio_complete_request</a>(request);</div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Error completing bgpio_request: %s\n&quot;</span>,</div>
<div class="line">                strerror(err));</div>
<div class="line">        exit(err);</div>
<div class="line">    }</div>
<div class="ttc" id="abgpiod_8c_html_ad9194ca37b57a3386cd88c60a7120833"><div class="ttname"><a href="bgpiod_8c.html#ad9194ca37b57a3386cd88c60a7120833">bgpio_complete_request</a></div><div class="ttdeci">int bgpio_complete_request(bgpio_request_t *req)</div><div class="ttdef"><b>Definition:</b> <a href="bgpiod_8c_source.html#l00401">bgpiod.c:401</a></div></div>
</div><!-- fragment --><p>Now we can perform fetch and set operations.</p>
<p>Before we do each, we must ensure that we specify which lines we wish to set or fetch from. Although the chardev interface allows fetches from output lines, it will not allow set operations on input lines.</p>
<p>The lines to be used for a fetch or set operation are specified in the <code><a class="el" href="structbgpio__request.html">bgpio_request</a>-&gt;line_values.mask</code> bitmap indexed by the order in which the lines were added to the request using <code><a class="el" href="bgpiod_8c.html#ab845cc372ba3506973ba09cb1d4bbfd7">bgpio_configure_line()</a></code>. So, if we have added lines 30, 42, and 47. Line 30 would be represented by bit 0, 42 by bit 1 and 47 by bit 2.</p>
<p>For each line to be accessed, a 1 should appear in the bitmap, with a 0 for lines to be ignored.</p>
<p>The following code fetches from <code>line0</code>: </p><div class="fragment"><div class="line"> </div>
<div class="line">    request-&gt;line_values.mask = 1; <span class="comment">/* Fetch line0 (index 0) */</span></div>
<div class="line">    result =  <a class="code" href="bgpiod_8c.html#a22eabec5d3b9ed223f79624b134fa100">bgpio_fetch</a>(request);</div>
<div class="ttc" id="abgpiod_8c_html_a22eabec5d3b9ed223f79624b134fa100"><div class="ttname"><a href="bgpiod_8c.html#a22eabec5d3b9ed223f79624b134fa100">bgpio_fetch</a></div><div class="ttdeci">int bgpio_fetch(bgpio_request_t *req)</div><div class="ttdef"><b>Definition:</b> <a href="bgpiod_8c_source.html#l00438">bgpiod.c:438</a></div></div>
</div><!-- fragment --><p>To set <code>line1</code> we must similarly set the <code>mask</code> bitmap. We also directly set the <code>bits</code> bitmap in the same struct to represent the 1s and 0s to be sent to the selected gpio lines. This is an alternative to using <code><a class="el" href="bgpiod_8c.html#ab4a43216beffb3333e563701f0883ce2">bgpio_set_line()</a></code>. </p><div class="fragment"><div class="line">    request-&gt;line_values.mask = 2; <span class="comment">/* Set line1 (index 1) */</span></div>
<div class="line">    request-&gt;line_values.bits = 2; <span class="comment">/* Set it to 1 */</span></div>
<div class="line">    result = <a class="code" href="bgpiod_8c.html#a0715d8885733ba28d045d0063c9d5daf">bgpio_set</a>(request);</div>
<div class="ttc" id="abgpiod_8c_html_a0715d8885733ba28d045d0063c9d5daf"><div class="ttname"><a href="bgpiod_8c.html#a0715d8885733ba28d045d0063c9d5daf">bgpio_set</a></div><div class="ttdeci">int bgpio_set(bgpio_request_t *req)</div><div class="ttdef"><b>Definition:</b> <a href="bgpiod_8c_source.html#l00373">bgpiod.c:373</a></div></div>
</div><!-- fragment --><p>The example code repeats the set and fetch operations, printing the results of the fetches.</p>
<p>If the gpio pins for <code>line0</code> and <code>line1</code> are connected with a 10KÎ© resistor, the fetches will show the changing values of the gpio output pin.</p>
<p>Finally, if you need to change an input line to an output, you will need to first reconfigure the gpio lines. You will use <a class="el" href="bgpiod_8c.html#ad5d0d5c5553253a60cdb7cad05556fff">bgpio_reconfigure()</a> for this. No example is provided but the usage should be easy enough to figure out if you've got this far. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
